<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>BlackLab Server Test Suite</title>
		<script src='jQuery.js'></script>
		<style>
textarea {
	display: block;
	padding-left: 10px;
}

input {
}

label {
	display: inline;
}
		
textarea {
	background-color: black;
	color: yellow;
	border: 1px solid yellow;
	padding: 3px;
	width: 100%;
	height: 200px;
	overflow: auto;
}
		</style>
		<script>

// Shim Date.now() (for pre-ES5 browsers)
if (!Date.now) {
    Date.now = function() { return new Date().getTime(); };
}

// Show test output
function output(msg) {
	$("#output").append(msg + "\n");
}

var queryNum = 1;

function createIndex() {
	var testFail = $("#testFail").prop("checked");
	
	var userId = "jan";
	
	var indexName = $("#indexName")[0].value;
	output("Creating index: " + indexName);
	
	var addParam = '';
	if (!testFail) {
		// NOTE: "data" doesn't work for DELETE in jQuery;
		// manually put params in URI
		addParam = "?userid=" + userId;
	}
	
	$.ajax("../" + indexName + addParam, {
		"type": "PUT",
		"accept": "application/json",
		"dataType": "json",
		"success": function (data) {
			if (data['error'])
				output("Error for create request: " + data['error']['message']);
			else
				output("Success; message = " + data['status']['message']);
		},
		"error": function (jqXHR, textStatus, errorThrown) {
			output("Error for create request: " + textStatus + "; " + errorThrown);
		},
	});
}

function deleteIndex() {
	var testFail = $("#testFail").prop("checked");
	
	var userId = "jan";
	
	var indexName = $("#indexName")[0].value;
	output("Deleting index: " + indexName);
	
	var addParam = '';
	if (!testFail) {
		// NOTE: "data" doesn't work for DELETE in jQuery;
		// manually put params in URI
		addParam = "?userid=" + userId;
	}
	
	$.ajax("../" + indexName + addParam, {
		"type": "DELETE",
		"accept": "application/json",
		"dataType": "json",
		"success": function (data) {
			if (data['error'])
				output("Error for delete request: " + data['error']['message']);
			else
				output("Success; message = " + data['status']['message']);
		},
		"error": function (jqXHR, textStatus, errorThrown) {
			output("Error for delete request: " + textStatus + "; " + errorThrown);
		},
	});
}

		</script>
	</head>
	<body>
		<h1>BlackLab Server Indexing Test</h1>
		<form onsubmit='return false;'>
			<label for='output'>Console:</label><br/>
			<textarea id='output'></textarea>
			<hr/>
			<label for='indexName'>Index name:</label> 
			<input type='text' id='indexName' value='jan:gysseling' />
			<input type='button' value='Create index' onclick='createIndex();' />
			<input type='button' value='Delete index' onclick='deleteIndex();' /><br/>
			<input type='checkbox' id='testFail' /> <label for='testFail'>Test auth failure?</label>
		</form>
	</body>
</html>
